var b=(F,u,d)=>new Promise((n,x)=>{var l=r=>{try{f(d.next(r))}catch(g){x(g)}},_=r=>{try{f(d.throw(r))}catch(g){x(g)}},f=r=>r.done?n(r.value):Promise.resolve(r.value).then(l,_);f((d=d.apply(F,u)).next())});import{d as O,k,r as P,e as G,u as e,_ as B,$ as K,t as D,A as T,f as s,aa as a,E as c,a1 as m,a9 as j,ac as q,a0 as W,a2 as Q,ai as H,F as J}from"./vue-05cc5022.js";import{_ as X}from"./LoginFormTitle.vue_vue_type_script_setup_true_lang-0b40a362.js";import{a as Y,k as Z,b as ee,r as se,h as ae}from"./index.js";import{u as oe,a as te,b as le,L as w}from"./useLogin-c4244b2d.js";import{ai as h,$ as z,aj as ne,_ as v,ac as re,ak as ie,al as ue,am as de,an as ce,ao as me,ap as ge,ab as pe,aa as fe}from"./antd-5cc557c7.js";const Ce=O({__name:"LoginForm",setup(F){const u=pe,d=fe,n=h.Item,x=z.Password,{t:l}=ee(),{notification:_,createErrorModal:f,createConfirm:r}=ae(),{prefixCls:g}=Y("login"),M=Z(),{setLoginState:C,getLoginState:N}=oe(),{getFormRules:A}=te(),I=k(),S=k(!1),$=k(!1),i=P({account:"vben",password:"123456",groupid:0}),{validForm:U}=le(I),R=G(()=>e(N)===w.LOGIN),y=k([]);function V(){return b(this,null,function*(){se.push({path:"/reg"})})}function E(){return b(this,null,function*(){var o;const p=yield U();if(p){console.log("login",p);try{S.value=!0;const t=yield M.login({password:p.password,username:p.account,groupid:p.groupid,mode:"none"});if(t&&t.token!="")_.success({message:l("sys.login.loginSuccessTitle"),description:`${l("sys.login.loginSuccessDesc")}: ${t.realName}`,duration:3});else{y.value=(o=t.groups)==null?void 0:o.map(L=>({label:L.name,value:L.id})),i.groupid=y.value[0].value,console.log(y);return}}catch(t){console.error(t),f({title:l("sys.api.errorTip"),content:t.message||l("sys.api.networkExceptionMsg"),getContainer:()=>document.body.querySelector(`.${g}`)||document.body})}finally{S.value=!1}}})}return(p,o)=>(B(),K(J,null,[D(s(X,{class:"enter-x"},null,512),[[T,R.value]]),D(s(e(h),{class:"p-4 enter-x",model:i,rules:e(A),ref_key:"formRef",ref:I,onKeypress:H(E,["enter"])},{default:a(()=>[s(e(n),{name:"account",class:"enter-x"},{default:a(()=>[s(e(z),{size:"large",value:i.account,"onUpdate:value":o[0]||(o[0]=t=>i.account=t),placeholder:"11位手机号码",class:"fix-auto-fill"},null,8,["value"])]),_:1}),s(e(n),{name:"password",class:"enter-x"},{default:a(()=>[s(e(x),{size:"large",visibilityToggle:"",value:i.password,"onUpdate:value":o[1]||(o[1]=t=>i.password=t),placeholder:e(l)("sys.login.password")},null,8,["value","placeholder"])]),_:1}),s(e(d),{class:"enter-x"},{default:a(()=>[s(e(u),{span:12},{default:a(()=>[s(e(n),null,{default:a(()=>[s(e(ne),{checked:$.value,"onUpdate:checked":o[2]||(o[2]=t=>$.value=t),size:"small"},{default:a(()=>[c(m(e(l)("sys.login.rememberMe")),1)]),_:1},8,["checked"])]),_:1})]),_:1}),s(e(u),{span:12},{default:a(()=>[s(e(n),{style:{"text-align":"right"}},{default:a(()=>[s(e(v),{type:"link",size:"small",onClick:o[3]||(o[3]=t=>e(C)(e(w).RESET_PASSWORD))},{default:a(()=>[c(m(e(l)("sys.login.forgetPassword")),1)]),_:1})]),_:1})]),_:1})]),_:1}),y.value.length>0?(B(),j(e(n),{key:0,name:"groupid",class:"enter-x"},{default:a(()=>[s(e(re),{value:i.groupid,"onUpdate:value":o[4]||(o[4]=t=>i.groupid=t),options:y.value},null,8,["value","options"])]),_:1})):q("",!0),s(e(n),{class:"enter-x"},{default:a(()=>[s(e(v),{type:"primary",size:"large",block:"",onClick:E,loading:S.value},{default:a(()=>[c(m(e(l)("sys.login.loginButton")),1)]),_:1},8,["loading"])]),_:1}),s(e(d),{class:"enter-x"},{default:a(()=>[s(e(u),{md:8,xs:24},{default:a(()=>[s(e(v),{block:"",onClick:o[5]||(o[5]=t=>e(C)(e(w).MOBILE))},{default:a(()=>[c(m(e(l)("sys.login.mobileSignInFormTitle")),1)]),_:1})]),_:1}),s(e(u),{md:8,xs:24,class:"!my-2 !md:my-0 xs:mx-0 md:mx-2"},{default:a(()=>[s(e(v),{block:"",onClick:o[6]||(o[6]=t=>e(C)(e(w).QR_CODE))},{default:a(()=>[c(m(e(l)("sys.login.qrSignInFormTitle")),1)]),_:1})]),_:1}),s(e(u),{md:6,xs:24},{default:a(()=>[s(e(v),{block:"",onClick:o[7]||(o[7]=t=>V())},{default:a(()=>[c(m(e(l)("sys.login.registerButton")),1)]),_:1})]),_:1})]),_:1}),s(e(ie),{class:"enter-x"},{default:a(()=>[c(m(e(l)("sys.login.otherSignIn")),1)]),_:1}),W("div",{class:Q(["flex justify-evenly enter-x",`${e(g)}-sign-in-way`])},[s(e(ue)),s(e(de)),s(e(ce)),s(e(me)),s(e(ge))],2)]),_:1},8,["model","rules","onKeypress"]),[[T,R.value]])],64))}});export{Ce as _};
